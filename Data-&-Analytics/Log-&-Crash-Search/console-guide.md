## Data & Analytics > Log & Crash Search > コンソール使用ガイド

Log & Crash Searchは、次のような順序で使用できます。

- サービス有効化
プロジェクトを作成し、プロジェクトを選択した後、 Log & Crash Searchを有効化します。
- ログ転送
Log & Crash Search SDKを通して、ログの転送を開始します。
- ログ確認 
ログを転送した後は、**ログ検索**または**アプリクラッシュ検索**画面でチャートや検索など、多様な方式でログを確認できます。

## プロジェクト選択

コンソールに接続し、左側メニューを利用して組織(Organization)とプロジェクト(Project)を選択します。組織やプロジェクトがない場合は、作成する必要があります。
- 左側メニューから**ORGANIZATION > PROJECT**をクリックします。

組織とプロジェクトの作成方法は[NHN Cloudコンソール使用ガイド](https://docs.toast.com/ko/TOAST/ko/console-guide/)を参照してください。

## サービス有効化

プロジェクト(Project)を選択した状態で、画面上部にある**サービス選択**ボタンをクリックして、**Data & Analytics**の下**Log & Crash Search**をクリックします。サービスが有効になると、サービス名の横に選択(v)表示が現れます。

> [参考]  
> サービスを有効にした後は、約5分後から転送できます。

Log & Crash Searchが有効になると、左側メニューに**Data & Analytics > Log & Crash Search**メニューが現れ、Appkeyが作成されます。

## Appkey確認

ログを転送するには、Appkeyを確認する必要があります。

1. 左側のメニューから、**Data & Analytics > Log & Crash Search > ログ検索**をクリックします。
2. コンソール画面上部の**URL & Appkey**ボタンをクリックすると、Log & Crash Search用Appkeyを確認できます。

## ログ転送

ログを転送するには、Log & Crash Search SDKが必要です。
SDKは[NHN Cloud Downloads](https://docs.toast.com/ko/Download/)ページの**Data & Analytics > Log & Crash Search**でダウンロードできます。

> [参考]  
> SDK使用時に、クラッシュログと一緒に送信されるセッションログは検索画面に表示されません。</br>
> セッションログの送信時、[リソース提供ポリシー](https://docs.toast.com/ko/TOAST/ko/resource-policy/#log-crash-search)の日次ログ件数提供量には他のログと同じように合算して反映されますが、API呼び出し料金には反映されません。

## ログ検索

転送したログをLog Search機能を利用して検索してみましょう。

1. コンソール画面の左側にあるメニューから**Data & Analytics > Log & Crash Search > ログ検索**をクリックします。
2. **ログ検索**タブには、基本的に24時間のログ量のグラフと詳細内容が表示されます。

**ログ検索**画面は、次のように構成されています。

![lcs_02_ja_20200602](https://static.toastoven.net/prod_logncrash/lcs_02_ja_20200602.png)

| 項目 | 説明 |
|---|---|
| 検索クエリー入力 | クエリーフィールド検索はLucene文法を使用できます。 <br/> (参照：https://docs.toast.com/ko/Data%20&%20Analytics/Log%20&%20Crash%20Search/ko/lucene-query-guide/)|
| 検索対象期間 | 検索クエリーの期間条件を設定できます。 |
| ログ検索結果 > チャート | ログ検索結果を棒グラフで表示し、棒グラフのバーをクリックするとそのバーのログ期間を再検索してログを確認できます。 |
| ログ結果ダウンロード | ログ検索結果を任意のフォーマットでダウンロードできます。またクラッシュダンプデータのみ別途ダウンロードが可能です。 |
| 選択したフィールド | ログフィールドに応じて右側の結果テーブルカラムを変更できます。 **追加ボタン**を使用して他のフィールドを追加および削除できます。 |
| ログ検索結果 > ログレコード | 検索したログの詳細内容が表示される部分です。表示されたログの各項目は、クリックして検索クエリーを変更できます。 |

ユーザーが設定した検索条件は、検索クエリー入力ウィンドウに反映され、頻繁に使用するクエリの場合はクエリ保存ボタンを使用して保存しておき、後で簡単に呼び出すことができます。保存したクエリは**保存クエリリスト**で確認および管理が可能です。

> [参考]
データの長さが1,000,000文字を超えるフィールドを含むログは検索ができません。そのため、照会ができないログは問題が解決するまでログダウンロード機能を利用して照会をお願いします。
>

## アプリクラッシュ照会

Android、iOS端末のクラッシュ情報は、**Data & Analytics > Log & Crash Search > アプリクラッシュ検索**で確認できます。


### イシュー照会
**イシュー照会**タブの**エラータイプ**で**Crashes**を選択すると、イシューを確認できます。

![lcs_03_201812](https://static.toastoven.net/prod_logncrash/lcs-appcrash-01-20211028.png)

**イシュー照会**タブの**エラータイプ**で**Handled**を選択すると、handledイシューを確認できます。

![lcs_04_201812](https://static.toastoven.net/prod_logncrash/lcs-appcrash-02-20211028.png)

|項目|	説明|
|---|---|
|チャート| イシュー要約とクラッシュ発生件数をタイムラインチャートに表示します。|
|エラータイプ| システムで発生するCrashと、Exceptionブロックでユーザーが発生させるHandledに分類されます。|
|検索条件|	プラットフォーム - アプリプラットフォーム選択<br/>状態–クラッシュイシュー処理状態 <br/>アプリバージョン - アプリのバージョン<br/> OSバージョン–OSのバージョン <br/> タグ–タグ <br/> 最小発生数–クラッシュ発生最小N件以上のクラッシュ照会フィルタ <br/> 例外の種類–例外の種類別最近フィルタ <br/> 位置–クラッシュ発生地点別照会フィルタ |
|イシューリスト|イシューリストを表示します。右上のリストボックスを利用してソート順序を変更でき、リスト左側の選択ボックスからイシュー状態を変更できます。|

リストでイシューをクリックすると、該当イシューの詳細情報を確認できます。

![lcs_05_201812](https://static.toastoven.net/prod_logncrash/lcs-appcrash-03-20211028.png)

|項目|	説明|
|---|---|
|状態|	イシュー状態を未解決、解決、再登録、完了などの状態に設定できます|
|課題トラッカー設定|	GitHub、GitLabなど、外部の課題トラッカーを設定して、該当イシューを外部課題トラッカーに登録できます。|
|検索ページで表示|	クリックするとログ検索ページに移動します|
|タグ|	タグを追加したり、追加されたタグを変更、削除できます。|
|スタック追跡|	クラッシュが発生した例外の種類、例外の原因およびスタックトレース情報を表示します。|
|エラーインスタンス|	エラーインスタンスリストを表示します。|
|ユーザー| イシューを発生させたユーザーリストを表示します。|
|意見とヒストリー| 該当イシューに対してコメントを作成でき、プロジェクト構成メンバーが作成したコメントリストを表示します。該当イシューに対する管理履歴(状態変更、タグ追加、コメント作成など)をタイムラインで表示します。|

|ヒストリーグラフ| イシュー発生件数をタイムラインチャートとワールドマップで表示します。|
|マトリックス情報| ネットワーク、OSバージョン、デバイス、サービスプロバイダー、国情報を表示します。|

### イシュートレンド

![lcs_07_201812](https://static.toastoven.net/prod_logncrash/lcs-appcrash-04-20211028.png)

|項目|説明|
|---|---|
|時間条件| 統計時間条件を設定できます。 |
|検索条件| エラータイプ - Crashes / Handled選択 <br/> プラットフォーム - アプリプラットフォーム選択 |
|トレンドグラフ| さまざまなトレンドグラフを見ることができます。 <br/> - クラッシュ数 <br/> - クラッシュが発生した端末<br/>- OSバージョン別イシュー <br/> - 端末別イシュー <br/> - 国別イシュー|

### クラッシュレポート

![lcs_08_201812](https://static.toastoven.net/prod_logncrash/lcs-appcrash-05-20211028.png)

|項目|説明|
|---|---|
|時間条件| 統計時間条件を設定できます。 |
|照会オプション| 検索件数を調整できます。 |
|検索条件| 指標タイプ - 現在「アプリクラッシュ推移」のみ提供 <br/> プラットフォーム - アプリプラットフォーム選択 <br/> 統計時間単位 - グラフ指標の時間単位選択(日間 / 週間) |
|クラッシュグラフ| 検索期間内のクラッシュ発生数を表示します。 |
|クラッシュ指標| 検索期間内のアプリバージョン別セッション数/クラッシュ数/発生率(%)/前の期間のクラッシュ数/増加率(%)情報を提供します。|

### ユーザー別イシュー照会

ユーザー別クラッシュ発生情報を提供します。

1. SDKでuser_idを設定する場合に使用可能で、保存しない場合、すべてのユーザーは'-'と表示されます。
2. ユーザーは、ユーザーIDとデバイス名を組み合わせて区別します。すなわち、ユーザーIDが同じでもデバイスが異なれば、違うユーザーとして集計されます。

![lcs_11_201812](https://static.toastoven.net/prod_logncrash/lcs-appcrash-06-20211028.png)

|項目|	説明|
|---|---|
|時間条件| 統計時間条件を設定できます。 |
|検索条件| エラータイプ - システムで発生させるCrash統計とExceptionブロックでユーザーが発生させるHandledに区分 <br/> プラットフォーム - アプリプラットフォーム <br/> アプリバージョン - アプリバージョン <br/> ユーザー - SDKでuser_idに指定したユーザーID <br/> 端末 - デバイス名|
|ユーザー情報| アプリクラッシュユーザーの情報(デバイス、アプリバージョンなど)を表示します。 |

### イシュー統計
![lcs_12_201812](https://static.toastoven.net/prod_logncrash/lcs-appcrash-07-20211028.png)

|項目|説明|
|---|---|
|時間条件|	統計時間条件を設定できます。|
|検索条件| エラータイプ - システムで発生させるCrash統計とExceptionブロックでユーザーが発生させるHandledに区分 <br/> プラットフォーム - アプリプラットフォーム <br/> アプリバージョン - アプリバージョン <br/> 国 - イシューが発生したユーザーの国 <br/> OSバージョン - イシューが発生したデバイスのOSバージョン|
|クラッシュ別発生頻度円グラフ|	クラッシュ別の発生頻度を表示します。|
|クラッシュ別発生頻度順位テーブル|	クラッシュ別の発生頻度順位を表示します。|

## アラーム

ログおよびクラッシュに対するアラーム設定およびアラーム送信履歴を確認できます。
**Data & Analytics > Log & Crash Search > アラーム**をクリックします。

### ログアラーム設定

![lcs_13_202108](https://static.toastoven.net/prod_logncrash/lcs_13_202108_ja.png)

ログアラームに対するすべての機能を実行できるページです。

- アラームは発生数に応じたアラームと、ログの増減率に応じたアラームに区分されます。
- アラームを受信したいログタイプ(Luceneクエリー)を登録し、該当ログが発生したら条件に応じてアラームを送信します。
- [発生数]、[増減率]の2つのタイプのアラームがあります。
- **アラーム追加**ボタンを押すと、アラームを登録できます。

![lcs_14_202108](https://static.toastoven.net/prod_logncrash/lcs_14_202108_ja.png)

- アラームの設定方法は次のとおりです。
    - アラームタイトル：アラーム設定リストに表示される名前を入力します。
    - アラームクエリー：アラームを受信したいログタイプをLuceneクエリーで入力します。
    - 説明：アラームの説明を入力します。
    - アラームタイプ：発生数または増減率でアラームタイプを設定します。
    - アラームタイプが発生数の場合
        - アラームルール：**しきい値**に適用される不等号を選択します。
        - しきい値：「検索条件」を満たすログが「アラームルール」不等号に応じて「しきい値」と同数発生したらアラームを送信します。
        - 発生周期：分単位で入力します。入力した時間値内にログが「しきい値」と同数発生したらアラームを送信します。
    - アラームタイプが増減率の場合
        - しきい値：「検索条件」を満たすログの増減率です。正の値はログが以前の間隔に比べて増加した比率。0は以前の間隔とログ量が同じ。負の値は以前の間隔よりログ量が減少した比率です。
        - 比較時間：時間単位で入力し、入力した時間間隔とそれ以前の間隔の間のログ量を「しきい値」に合わせて比較します。 「比較時間」中に発生したログの増減率が「しきい値」を満たすと、アラームを送信します。
    - スヌーズ：分単位で入力し、最小1分～最大1,440分(24時間)の間の値を設定します。(0は消える)
    - 受信者：アラームを受信する受信者を入力します。受信者ごとにメールとSMSを選択できます。
    - SMSアラーム文言：アラーム送信時にSMSで送信する文言を入力します。
    - コールバックURL：アラーム送信時に呼び出されるURLを入力します。 http(s)://とメール、Doorayフックをサポートします。

### ログアラーム履歴

![lcs_15_202108](https://static.toastoven.net/prod_logncrash/lcs_15_202108_ja.png)

- 設定したアラームリストが表示されます。
- リストをクリックすると、該当アラーム発生内容を確認できます。

### クラッシュアラーム設定

![lcs_16_202108](https://static.toastoven.net/prod_logncrash/lcs_16_202108_ja.png)

クラッシュログに対するアラームを別途設定する機能です。プラットフォーム(iOS、Android、Windows、WebGL)別にそれぞれ1つずつ登録できます。

アラーム設定方法は次のとおりです。

- プラットフォーム：アラーム発生対象プラットフォームをiOS、Android、Windows、WebGLのうち1つを指定します。
- 新規クラッシュアラーム設定：アラーム発生をOn/Off処理できます。
- しきい値ベースのクラッシュアラーム設定：設定しきい値を超えると、アラームが作動するように設定します。探知周期は10分です。
    - アラームタイプ：クラッシュ発生数とクラッシュ発生率タイプがあります。
    - しきい値：クラッシュ発生数タイプはログ発生数(回数)を、クラッシュ発生率はログ発生確率(パーセント)を設定します。
- SMS通知文言使用：有効にすると、障害内容の代わりにSMSアラーム文言に入力した内容がSMSで送信されます。
- アラーム受信者：プロジェクトメンバーリストから、アラームを受信するユーザーのメール、 SMSを選択します。

### クラッシュアラーム履歴

![lcs_17_202108](https://static.toastoven.net/prod_logncrash/lcs_17_202108_ja.png)

クラッシュログアラームが発生した履歴を照会します。

- プラットフォーム別に照会できます。
- 時間条件を設定して照会期間を調整できます。
- アラーム時間、プラットフォーム、クラッシュタイプ、しきい値、イベント数、配信方法および送信状態を提供します。

### ユーザーべースのアラーム設定

![lcs_18_202108](https://static.toastoven.net/prod_logncrash/lcs_18_202108_ja.png)

クラッシュが発生したユーザー比率がしきい値(%)以上の場合、指定されたユーザーの携帯電話またはメールにアラームを送信する機能を提供します。

アラーム設定方法は次のとおりです。

- プラットフォーム：アラーム発生対象プラットフォームをiOS、Android、Windows、WebGLの中から1つを指定します。
- ユーザー基盤アラーム設定：アラーム発生をON/OFF処理できます。
- しきい値：クラッシュしたユーザー比率がしきい値(%)以上の場合、指定されたユーザーの端末またはメールにアラームを送信します。
- SMSアラーム文言：有効にすると、障害内容の代わりにSMSアラーム文言に入力された内容がSMSで送信されます。
- アラーム受信者：プロジェクトメンバーリストから、アラームを受信するユーザーのメール、SMSを選択します。

### ユーザー基盤アラーム履歴

![lcs_20_ja_20200602](https://static.toastoven.net/prod_logncrash/lcs_20_ja_20200602.png)

ユーザー基盤アラームが発生した履歴を照会します。

- プラットフォーム別に照会できます。
- 時間条件を設定して、照会期間を調節できます。
- アラーム時間、プラットフォーム、しきい値、クラッシュ発生ユーザー比率、配信方法および転送状態を提供します。

## 設定

検索フィールド管理、課題トラッカー設定、シンボルファイル管理などのサービスに必要な設定を管理します。

**Data & Analytics > Log & Crash Search > 設定**をクリックします。


### 検索フィールド

ログ検索時に使用される検索フィールドを照会する機能です。システムフィールドである基本フィールドリストの他に、ユーザー転送フィールドであるユーザー指定フィールド(カスタムフィールド)を確認できます。

![lcs_20_202108](https://static.toastoven.net/prod_logncrash/lcs_20_202108_ja.png)

1. ログ転送時、フィールド名がtxtで始まる場合、分析するかどうかがtrueに設定され、それ以外のフィールドは分析するかどうかがfalseに設定されます。分析するかどうかがfalseの場合、ログ検索の検索フィールドに登録して使用できます。
2. ログファイルやバイナリファイルを転送して、**ログ検索**画面で**ダウンロード > 参照**リンクを利用したい場合、 UserBinaryDataまたはUserTxtDataという名前のフィールドにbase64エンコードされた値を入れて転送してください。

### イシュートラッキング

課題トラッカーを設定すると、**アプリクラッシュ検索 > イシュー照会**タブでイシューリストをクリックした時に表示されるError Detailページで、該当エラーを課題トラッカーに登録して管理できます。

![lcs_21_202108](https://static.toastoven.net/prod_logncrash/lcs_21_202108_ja.png)

- プラットフォーム： iOS、Android、Windows、WebGLのうち1つのプラットフォームを選択します。課題トラッカーはプラットフォーム別にそれぞれ設定可能です。
- 課題トラッカー： GitHub、GitLabのうち1つを選択します。
- GitHubプロジェクトURL：課題トラッカーをGitHubに選択する場合、https://github.com/{user}/{project}形式のURLを入力します。
- Access token：課題トラッカーをGitHubに選択する場合、GitHubで作成したAccess tokenを入力します。(参照： https://help.github.com/articles/creating-an-access-token-for-command-line-use)
- GitLabプロジェクトURL：課題トラッカーをGitLabに選択する場合、http://{baseUrl}/{namespace}/{project}形式のURLを入力します。
- Private token：課題トラッカーをGitLabに選択する場合、GitLabサイトのMy profile - Accountで作成したtoken値を入力します。
- Issue Title Format：イシュータイトルにバージョンおよび位置情報を含めるかどうかを選択します。
- テスト：設定が正常かどうかを確認します。

### シンボルファイル

Symbolication fileが登録されていると、クラッシュログを確認できます。このメニューではSymbolication fileをアップロード、ダウンロードして削除できます。

![lcs_22_202108](https://static.toastoven.net/prod_logncrash/lcs_22_202108_ja.png)

**[ファイル選択]**をクリックして、シンボルファイルをアップロードします。

- iOS： iOSシンボリケーションファイルをアップロードする時は、ZIP形式でBundleName.app.dSYMファイルを圧縮してください。
- Android： Androidシンボリケーションをアップロードする時は、mapping.txtファイルをアップロードする必要があります。
- Android-NDK： Android NDKファイルをアップロードする時は、ZIP形式でlib.soファイルを圧縮してください。
- Windows： Windowsシンボリケーションファイルをアップロードする時は、ZIP形式でBundleName.symファイルを圧縮してください。
- シンボルファイルの最大サイズは200MBです。
- Android NDKシンボリケーションファイルが許可する最大ファイルサイズを超える場合、原本‘lib.so’バイナリファイルのテキスト形式シンボルを含んでいる1つの‘lib.so.sym’を含むZIPファイル形式でアップロードできます。
- Android Unityの場合、シンボルファイルの登録が必要ありません。ただし、ProGuard適用時にmapping.txt.のアップロードが必要です。

### ログ保管期間

ログ保管期間を設定します。

![lcs_23_202108](https://static.toastoven.net/prod_logncrash/lcs_23_202108_ja.png)

- ログ保管期間は1ヶ月、2ヶ月、3ヶ月、4ヶ月の中から選択でき、ひと月に1回のみ変更できます。
