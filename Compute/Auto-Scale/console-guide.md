## Compute > Auto Scale > コンソール使用ガイド

## インスタンステンプレート
スケーリンググループ(Scaling Group)を作成する時、インスタンステンプレート(Instance Template)を利用できます。インスタンステンプレートはスケーリンググループを構成する個別インスタンスのコンポーネント情報をあらかじめ定義します。詳細は[インスタンステンプレートコンソールガイド](/Compute/Instance%20Template/ja/console-guide/)を参照してください。

## スケーリンググループ
### スケーリンググループリスト表示
現在有効化しているスケーリンググループを表示します。リスト表示画面では各スケーリンググループの状態を確認できます。

- 最小/最大インスタンス：スケーリンググループが生成できる最小/最大インスタンスの数です。
- 現在のインスタンス：スケーリンググループが現在保有中のインスタンスの数です。
- インスタンステンプレート：スケーリンググループが使用中のインスタンステンプレートです。
- ロードバランサー：スケーリンググループが使用中のロードバランサーです。
- 状態：スケーリンググループの状態です。スケーリンググループのポリシー発動による動作成功可否を確認できます。スケーリンググループの状態は[動作]_[動作状態]で構成されます。

| 動作 | 説明 |
|--|--|
| CREATE | スケーリンググループの作成 |
| UPDATE | スケーリンググループの変更<br>スケーリンググループが所有するリソースの変動 |
| HANDOVER | スケーリンググループオーナーの変更 |
| SUSPEND | スケーリンググループの停止 |
| RESUME | スケーリンググループの開始 |
| DELETE | スケーリンググループの削除 |

| 動作状態 | 説明 |
|--|--|
| IN_PROGRESS | 動作している状態 |
| COMPLETE | 動作が完了した状態 |
| FAILED | 動作が失敗した状態 |

<br/>

> [参考]
> 動作が失敗した状態のスケーリンググループは正常に動作しない可能性があります。
> サポートにお問い合わせください。
<br/>

### スケーリンググループ生成
スケーリンググループでは次のような項目を定義できます。

<table class="sg">
  <tr>
    <th>分類</th>
    <th>項目</th>
    <th>説明</th>
  </tr>
  <tr>
    <td rowspan="5">設定</td>
    <td>名前</td>
    <td>スケーリンググループの名前、英字、 '-'、 '.' 、数字、20文字以内</td>
  </tr>
  <tr>
    <td>インスタンステンプレート</td>
    <td>スケーリンググループが使用するインスタンステンプレート</td>
  </tr>
  <tr>
    <td>最小インスタンス</td>
    <td>スケーリンググループ有効化時、最小限維持されるインスタンスの数</td>
  </tr>
  <tr>
    <td>最大インスタンス</td>
    <td>スケーリンググループ有効化時、生成できる最大インスタンスの数</td>
  </tr>
  <tr>
    <td>駆動インスタンス</td>
    <td>スケーリンググループ最初の有効化時、生成されるインスタンスの数</td>
  </tr>
  <tr>
    <td rowspan="4">増設/縮小ポリシー</td>
    <td>条件</td>
    <td>拡張/縮小ポリシーの発動条件<br>監視する性能指標、基準値、持続時間を指定</td>
  </tr>
  <tr>
    <td>条件演算子</td>
    <td>発動条件の間に適用する演算子<br><b>and</b>を選択すると、各条件を全て満たした時、ポリシー発動<br><b>or</b>を選択すると、条件のうち1つを満たした時にポリシー発動</td>
  </tr>
  <tr>
    <td>インスタンス調整</td>
    <td>ポリシーが発動した時に生成、もしくは削除されるインスタンスの数</td>
  </tr>
  <tr>
    <td>再使用待機時間</td>
    <td>ポリシーが発動した後、再発動するまでに待機する時間<br>再使用待機時間が経過していなければ、条件を満たしてもポリシーが発動しない</td>
  </tr>
  <tr>
    <td>自動復旧ポリシー</td>
    <td>自動復旧</td>
    <td>自動復旧ポリシーを使用するかどうか</td>
  </tr>
  <tr>
    <td>ロードバランサー</td>
    <td>選択されたロードバランサー</td>
    <td>生成されたインスタンスが接続されるロードバランサー</td>
  </tr>
  <tr>
    <td>追加ポリシー</td>
    <td>Deploy連携</td>
    <td>増設時にDeployサービスを利用した自動配布機能を使用するかどうか</td>
  </tr>
</table>

<br/>

> [参考]
> 自動復旧ポリシーを使用すると、個別インスタンスに障害が発生した時、そのインスタンスを削除し、新しいインスタンスを作成して置き換えます。
> 個別インスタンスの性能指標が3分間収集されなかった場合、障害と判断して自動復旧が行われます。
> 自動復旧は再使用待機時間に関係なく動作します。
<br/>

> [参考]
> Deploy連携を使用するように設定してスケーリンググループを作成すると、増設時に自動的にアプリケーションを配布するようにDeployサービスに登録できます。
> 詳細は[Deployガイド](/Dev%20Tools/Deploy/ja/console-guide/)を参照してください。
> Deploy連携機能は2021年07月現在、韓国(パンギョ)、韓国(ピョンチョン)、日本(東京)リージョンでのみ提供されます。
> Deploy連携時にUnicodeを含むユーザースクリプトは動作しません。


### ロードバランサー変更
スケーリンググループにロードバランサーを接続したり、接続されたロードバランサーを除去、交換できます。接続するロードバランサーはあらかじめ作成されている必要があります。

> [参考]
> すでに接続されているロードバランサーにリスナーを追加しても、現在のスケーリンググループのインスタンスが自動的に新しいリスナーに接続されません。
> 新しいリスナーに接続する時は、ロードバランサーの接続を解除して、再度接続する必要があります。

<br/>

> [注意]
> スケーリンググループにロードバランサーを接続するにはInfrastructure Load Balancer ADMINまたはInfrastructure ADMIN権限が必要です。
> ロードバランサーを変更すると、現在のインスタンスは削除され、新しいインスタンスが作成されます。

### スケーリンググループ停止
スケーリンググループリストから任意のスケーリンググループを選択して一時停止します。停止したスケーリンググループは`スケーリンググループ開始`ボタンをクリックして起動できます。

> [参考]
> 一時停止したスケーリンググループの状態は黄色で表示されます。
> 一時停止したスケーリンググループはインスタンス数、スケーリンググループポリシー変更、ロードバランサー変更、予約作業作成などを含むすべての操作機能が制限されます。
> また所属インスタンスが停止するため、統計グラフも使用できません。

### スケーリンググループオーナーの変更
変更したいオーナーを選択すると、選択されたオーナーが所有するスケーリンググループが表示されます。オーナーを自分に変更するスケーリンググループを選択します。
変更後のスケーリンググループは、オーナー変更時に選択したキーペアで管理できます。

> [参考]
> スケーリンググループ作成時、オーナーは作成リクエストしたユーザーに設定されます。
> [注意]
> オーナー変更後に作成されるインスタンスは、オーナー変更時に選択したキーペアでアクセスできますが、変更前に作成された既存インスタンスは変更前のキーペアでアクセスする必要があります。したがってキーペアファイルはユーザーレベルで適切に管理する必要があります。

### 詳細情報表示、修正
スケーリンググループリストから、スケーリンググループを選択して詳細情報を確認します。

詳細情報画面で `編集`を選択すると、スケーリンググループの属性を修正できます。スケーリンググループを修正して使用中のインスタンステンプレートの変更や最小、最大、駆動インスタンスの変更ができます。

### ポリシー表示、実行
スケーリンググループリストから、スケーリンググループを選択してスケーリングポリシーを確認します。

スケーリングポリシー画面で`編集`を選択すると、スケーリングポリシーを修正できます。また拡張/縮小ポリシーで`実行`を選択して強制的にポリシーを発動できます。

### 予約作業表示、生成
スケーリンググループリストから、スケーリンググループを選択して予約作業を確認します。

予約作業を通して指定された時間にスケーリンググループの最小、最大、駆動インスタンスの数を調整できます。
予約作業は一度のみ実行するか、周期的に実行するかを設定できます。

予約作業を生成する時に必要な項目は次のとおりです。

| 項目 | 説明 |
|--|--|
| 名前 | 予約作業の名前 |
| 変更項目 | 予約作業が変更するスケーリンググループの属性<br>最小、最大、駆動インスタンスの中から1つを選択|
| 値 | 変更項目で指定した属性の新しい値<br>指定した時間帯に`変更項目`から選択した属性をこの値に修正 |
| 繰り返し | 予約作業の繰り返し有無<br>1回またはCron式の中から1つを選択 |
| Cron式 | `繰り返し`をCron式に選択した場合に有効化する |
| 開始時間 | 予約作業が始まる時間<br>`繰り返し`を1回に選択した場合、開始時間に予約作業実行<br>`繰り返し`をCron式に選択した場合、開始時間を起点にして周期的に予約作業実行 |
| 終了時間 | 予約作業が終了する時間<br>`繰り返し`をCron式に選択した場合に有効化する |

> [参考]
> Cron式は予約作業の実行時間、周期を表すための式です。
>
> Cron式は5個の項目で構成され、各項目はスペースで区分します。項目ごとの意味は次のとおりです。
>
> | 項目 | 許容範囲 | 使用可能な特殊文字 |
> |--|--|--|
> | 分 | 0-59 | `*` `,` `-` |
> | 時間 | 0-23 | `*` `,` `-` |
> | 日 | 1-31 | `*` `,` `-` `?` `L` `W` |
> | 月 | 1-12<br>JAN-DEC | `*` `,` `-` |
> | 曜日 | 0-6<br>SUN-SAT | `*` `,` `-` `?` `L` `#` |
>
> 各項目では数字または特殊文字を使って実行時間を指定します。正確な文法は次のとおりです。
>
> | 特殊文字 | 意味 |
> |--|--|
> | * | 全ての時刻 |
> | - | 範囲 |
> | , | 特定の時間 |
> | / | 増加量 |
> | L | 最後の時間 |
> | W | 最も近い平日。 **日** 項目でのみ使用可 |
> | # | N番目の曜日。 **曜日** 項目でのみ使用可 |
>
> Cron式の使用例は次のとおりです。
>
> `0 10 * * *`：毎日10時0分に実行<br>
> `0/20 15 * * *`：毎日15時0分から20分間隔で実行、つまり15時0分、 20分、 40分に実行<br>
> `0 12-15 * * *`：毎日12時、 13時、 14時、 15時0分に実行<br>
> `0 0 15 6,7,8 *`： 6月7月8月15日0時0分に実行<br>


<br>

> [注意]
> 予約作業の開始時間は、現在時間の3分後以降にのみ指定できます。スケーリンググループが変更中の場合、予約作業の実行は遅延することがあります。

### 生成したインスタンスリスト表示
スケーリンググループリストから、スケーリンググループを選択し、生成したインスタンスリストを確認します。

> [注意]
> スケーリンググループが生成したインスタンスは、インスタンス商品のリストにも表示されます。しかし、ユーザーが任意で操作することはできません。

### 統計グラフ表示
スケーリンググループリストから、スケーリンググループを選択し、統計グラフを確認します。

> [参考]
> 統計グラフを通して、スケーリンググループに属するインスタンスの直近1日間の平均使用量を確認できます。また、増設または縮小時点と原因を把握できます。

統計グラフは、次のようなシステムリソースに対する統計データを提供します。

| システムリソース | 提供する統計データ |
| --- | --- |
| CPU使用率 | スケーリンググループに属するすべてのインスタンスのCPU使用量の平均 |
| メモリ使用率 | スケーリンググループに属するすべてのインスタンスのメモリ使用量の平均 |
| ディスク転送率 | スケーリンググループに属するすべてのインスタンスの1分当たりのディスク読み取り/書き込みデータ量の平均 |
| ネットワーク転送率 | スケーリンググループに属するすべてのインスタンスの1分当たりのネットワーク送信/受信データ量の平均 |

各グラフは5分間隔まで拡大して閲覧でき、最小1分単位の統計データを提供します。

> [参考]
> 統計値を取得するためには、スケーリンググループに属する各インスタンスのデータを収集する必要がありますが、すべてのインスタンスのデータを同時に収集することはできません。そのため、直近数分間は一部インスタンスのデータがない場合もあります。統計値は収集されたデータがないインスタンスを除外して計算されます。したがって、後に抜けていたインスタンスのデータが収集された場合、値が変更されることがあります。すべてのインスタンスのデータが収集された後は、常に同じ値が提供されます。
