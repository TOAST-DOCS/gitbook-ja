## Compute > System Monitoring > Advanced Monitoring(OpenMetrics) > コンソール使用ガイド
コンソール使用ガイドではAdvanced Monitoring(OpenMetrics)を使用するのに必要な内容を説明します。
**Compute > System Monitoring > OpenMetricsダッシュボード**ではモニタリングワークスペースを定義し、収集対象を指定してExporterまたはその形式に応じた任意の指標を収集できます。
収集された指標はサーバーダッシュボードと類似した方式でレイアウトとチャートを構成して確認できます。

## ワークスペース
アドバンスモニタリング(OpenMetrics)機能を使用するために、最初に行わなければいけないことは、ワークスペースを作ることです。モニタリング目的と性格が同じものを1つのワークスペースで定義し、収集対象と指標の視覚化方法を管理できます。
したがって、少なくとも1つ以上のワークスペースが存在する時のみ、アドバンスモニタリング(OpenMetrics)を使用できます。

### ワークスペース作成
ダッシュボード画面左にはワークスペースリストが表示されます。リストの最上段にはワークスペースを検索するための入力欄とワークスペース追加ポップアップを表示するためのボタンがあります。

**追加**ボタンを押すと、ワークスペース追加ポップアップが表示されます。
ワークスペースに名前と説明、URL Pathを入力して作成できます。
名前には英数字、(-)、(_)を入力できます。
URL Pathには指標を提供するページアドレスのうち、ドメインとポートなどを除いたPathだけを入力する必要があります。

* Path入力例

接続対象 | 入力値
-------- | -------
http://localhost:9100/metrics | `/metrics`
http://localhost:8080/actuator/prometheus | `/actuator/prometheus`

### ワークスペース修正/削除
ダッシュボードの左に表示されるワークスペースリストで、各ワークスペース項目の右に歯車アイコンがあります。このアイコンを押すとワークスペース管理ポップアップが表示されます。

説明とURL Pathを変更することができ、入力して**修正**ボタンを押すと変更できます。

ワークスペースを削除したい場合は、**削除**ボタンを押してワークスペースを削除できます。
ワークスペースを削除すると、そのスペースに作成された収集対象とレイアウト、チャートなどは全て削除されます。ただし、同じ名前のワークスペースをもう一度作成すると、収集された指標データは照会できます。

## 収集対象
ワークスペースを作成したら、各スペースでモニタリングする対象を指定する必要があります。ダッシュボードの左にあるワークスペースリストから使用するスペースを1つ選択すると、画面上に**収集対象管理**ボタンが表示されます。
このボタンを押すと、収集対象を追加/削除できるポップアップウィンドウが表示されます。

### 収集対象を追加
収集対象管理ポップアップの上部にはモニタリング対象の追加に必要な入力欄が表示されます。

**サーバー**入力欄を押すと、現在System MonitoringのAgentが正常に動作しているインスタンスが表示され、1つ以上を選択して収集する対象を指定できます。

**ポート**入力欄には指標情報を提供しているExporterまたはWebアプリケーションのポートを入力します。

サーバーとポートを入力すると、**追加**ボタンを押して対象を追加できます。
現在はワークスペースに関係なく各サーバーで最大5個の収集対象のみ登録できます。

### 収集対象照会
収集対象管理ポップアップの下部には、このワークスペース内に登録された収集対象のリストが表示されます。
状態値は色で区分して表示しています。正常収集以外は、円の上にマウスオーバーすると詳細な説明が表示されます。

色 | 意味
---- | ----
緑 | 正常収集中
黄色 | HTTPエラーレスポンス(404 Not Found, 503 Service Unavailableなど)
赤 | 収集不可状態(該当ポートがLISTENではない、またはタイムアウトなど)
灰色 | 収集準備中(収集対象登録直後またはインスタンスが停止した状態)

> もし時間が経っても灰色の状態が続く場合は、Agentを最新バージョンにアップデートしてください。
([Agentインストール方法](https://docs.toast.com/ja/Compute/System%20Monitoring/ja/console-guide/#agent))
アップデート後も変化がない場合はサポートへお問い合わせください。

### 収集対象の削除
収集対象管理ポップアップの下部リストの下には**削除**ボタンがあります。リストから削除する対象の左チェックボックスを選択した後、削除ボタンを押すとその対象はモニタリングが中断されます。

## レイアウト
ワークスペースを作成し、収集対象を指定すると、Agentは指標を収集してSystem Monitoringシステムにデータを保存します。保存されたデータを照会するにはレイアウトでチャートを構成する必要があります。レイアウトはサーバーダッシュボードで提供しているものと似たような機能を持っています。

### レイアウト作成
ダッシュボードにチャートを作って配置し、モニタリング情報を視覚化したい場合は、レイアウトを作って目的と観点に応じて構成できます。
レイアウトを作るにはダッシュボード上部の**レイアウト作成**ボタンを押します。レイアウトは各ワークスペースで最大5個まで作成できます。

**レイアウト作成**ウィンドウで名前を入力した後、**作成**ボタンを押すと、新しいレイアウトが作成されます。登録されたチャートがないため、空の画面が表示されます。新しいチャートを追加するには画面の案内に従って**チャート追加**ボタンを押します。

### レイアウト修正/削除
ダッシュボード上部の**管理**ボタンを押すと特定レイアウトの名前を変更したり、必要ないレイアウトを削除できます。

## チャート
アドバンスモニタリングのダッシュボードではシステムで提供しているチャートを選択するサーバーダッシュボードの方式とは異なり、ユーザーがチャートに表示したい指標と条件を直接指定して作成できます。

### チャート作成
レイアウトに新しいチャートを作成するにはダッシュボード上部の**チャート追加**ボタンを押します。

**チャート追加**ウィンドウでチャート名とチャートのY軸プロパティを定義し、指標登録と通知設定が行えます。指標と通知を設定する画面は、それぞれのタブに分かれています。
Y軸は、左側と右側をそれぞれ有効にできます。各軸に表示される数値の単位を指定できます。
有効化したY軸は、指標追加時、チャートに表示される格子の基準として選択します。したがって、左側と右側のどちらかは必ず有効にする必要があります。
指標は複数追加できます。ただし、最低1つの指標は追加されている必要があります。通知は任意で入力できます。

#### 指標
指標タブで**指標追加**ボタンを押すと、指標を追加するために入力が必要な内容が表示されます。

**指標**入力欄を押すと該当ワークスペースで現在収集中の指標のリストが表示されます。このリストから1つを選択できます。

指標入力欄の右側には有効化したY軸位置のリストが表示されます。リストの値を選択すると、その位置にあるY軸の範囲を基準に指標がチャートに表示されます。もし該当指標が表示する値がY軸の描写範囲を超えたら、その指標の最も大きい値が基準になって描写範囲を再設定します。

選択した指標がレーベルを持っている場合、それの値を比較して条件に合ったデータのみ照会できるように**フィルタ**を設定できます。該当指標が持っているレーベルの中から1つを選択して比較する値を入力します。フィルタ条件は複数のレーベルに対して指定できますが、同じレーベルに対して重複して設定することはできません。提供している比較方法は次のとおりです。


演算子 | 意味 | 例
-------- | ------- | -------
`=` | 一致する | `mode = user`<br/>`mode` レーベルの値が`user`のものだけ表示
`!=` | 一致しない | `mode != idle`<br/>`mode` レーベルの値が`idle`ではないものだけ表示
`=~` | 正規表現式にマッチ | `code =~ 2.*`<br/>`code` レーベルの値が`2`で始まるものだけ表示
`!~` | 正規表現式にマッチしない | `code !~ 5.*`<br/>`code` レーベルの値が`5`で始まらないものだけ表示

指標のプロパティを入力した後、**登録**ボタンを押すと、左側チャートプレビューで意図したとおりにデータが表示されているかを確認できます。

#### 通知
通知タブで**通知追加**ボタンを押すと、通知を設定するために入力する内容が表示されます。

通知設定を区分するために**名前**を入力し、監視対象の**しきい値**を入力します。設定したしきい値は該当チャートの指標に追加した項目全体に一括適用されます。 
**持続時間**はその条件が何分以上持続する場合にイベントが発生したと判断するかを設定します。この値を0にすると、周期ごとに収集された値がその条件を満たすと即時にイベントが発生したとみなして処理します。

**通知グループリスト**にはSystem Monitoringに作成された通知グループを選択できます。イベントが発生するとグループに指定された送信チャンネルを通してグループ内のユーザーにイベント発生履歴を通知します。(ただし、通知グループで参照する対象は**通知タイプ**と**ユーザーグループ**項目で、監視設定やサーバーリストはアドバンスモニタリングとは関係ありません。)

通知設定に必要な各項目を入力した後、**登録**ボタンを押すと入力した通知名がリストに追加されたことを確認できます。

指標選択と通知設定が完了すると、チャート追加ウィンドウ下部の**保存**ボタンを押してチャートを作成できます。

### チャート修正
各チャートの右上にある歯車アイコンを押すとチャートを修正できます。チャート作成時に使用したものと同じ形のポップアップウィンドウが表示されます。
変更が必要な部分を修正した後、下部の**修正**ボタンを押すと変更事項が反映されて保存されます。

### チャート削除
各チャートの右上にあるXアイコンを押すとチャートを削除できます。チャートを削除すると、そのチャートで有効になっている通知設定も同時に削除されます。
