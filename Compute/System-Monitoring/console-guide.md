## Compute > System Monitoring > コンソール使用ガイド
コンソール使用ガイドでは、System Monitoringの使用に必要な基本的な内容を説明します。
- サーバーダッシュボード
- ユーザーグループ
- 通知グループ

## サーバーダッシュボード
**Compute > System Monitoring > サーバーダッシュボード**では、モニタリング対象インスタンスリストと、基本指標チャートを確認できます。
もしモニタリングできるインスタンスがない時は、リストが空になっています。
この場合は、**Compute > Instance**で使用中のインスタンスが正常に動作しているか、またはモニタリング対象インスタンスにSystem Monitoring Agentがインストールされ正常に動作しているかを確認する必要があります。Agentのインストール方法は、**Agentのインストール方法**を参照してください。

モニタリング対象のインスタンスにAgentが正常にインストールされ、System Monitoringで指標データが収集されている場合、左側のサーバーリストに該当インスタンスが表示されます。インスタンスを選択すると、右側のチャートで収集された指標データを確認できます。

### サーバーリスト
サーバーリストから任意のインスタンスを選択し、各インスタンスの指標を確認できます。
サーバーリストにはインスタンスのホスト名、 IP、そしてモニタリング状態を表すインジケーター（丸印）が表示されます。
インジケーターの色は、現在のモニタリング状態に応じて変化します。

- 緑：正常
- 黄色：インスタンス情報は不明だが、モニタリングは行われている状態
- 赤：起動中のインスタンスにもかかわらず、モニタリングが中断されている状態
- 濃い灰色：作動が中断したインスタンス
- 薄い灰色：削除されたインスタンス

インスタンスとAgentの状態値は、インジケーターをマウスオーバーすると表示されるツールチップで確認できます。

**Compute > Instance**から削除されたインスタンスは、基本的にサーバーダッシュボードのサーバーリストには表示されません。しかし、指標データは削除されずに保管されます。削除されたインスタンスの指標を確認するには、**削除されたサーバーも表示**を選択します。

### 基本レイアウト
初めて**Compute > System Monitoring > サーバーダッシュボード**に表示されるチャート配列は、**基本レイアウト**です。追加設定なしで利用できる基本レイアウトです。**CPU Used**、**Memory Used(excepted cache/buffer)**、**Disk**、**Network(In/Out bps)**チャートを表示します。
基本レイアウト'は、System Monitoringで提供する固定のレイアウトのため、ユーザーが直接チャートを構成できません。

### レイアウトの作成
新しい指標の追加や、チャートの配置を行うには、新しいレイアウトが必要です。レイアウトを作成するには、サーバーダッシュボード上部の**レイアウト作成ボタン**をクリックします。レイアウトは、プロジェクトごとに最大5個まで作成できます。

**レイアウト作成**ウィンドウで名前を入力した後、**作成**ボタンをクリックすると、新しいレイアウトが作成されます。登録されたチャートがないため、空の画面が表示されます。新しいチャートを追加するには、画面の案内に従って**チャート追加**ボタンをクリックします。

### チャートの作成
**チャート追加**ボタンをクリックすると、選択可能な指標のリストが表示されます。

右側には現在System Monitoringで提供する指標リストが表示され、このうち1つを選択すると、左側にチャートプレビューが表示されます。**追加**ボタンをクリックすると、選択したチャートがレイアウトの下に追加されます。

直接作成したレイアウトは、ユーザーが自由にチャートの位置とサイズを調節できます。ユーザーが追加したチャートには、下記のような追加機能が提供されます。

- 右上のアイコンをクリック：レイアウトからチャートを削除します。
- 右下のアイコンをドラッグ：チャートのサイズを調節できます。
- チャートのタイトルをドラッグ：チャートの位置を変更できます。

作成したレイアウトは、上のレイアウトドロップダウンメニューで選択できます。

### レイアウトの修正/削除
**レイアウト管理**ボタンをクリックすると、特定レイアウトの名前変更や、不要なレイアウトの削除ができます。

### 日付選択
収集された指標データは、最大5年間保管されます。右上の**カレンダー**ボタンをクリックして、照会する範囲を設定します。

**日付検索**ウィンドウでは、照会期間に指定する**開始日(From)**と**終了日(To)**を選択します。開始日と終了日を選択する方法は2つです。
1つ目は、直接日付を選択する方法です。開始日、終了日をクリックすると、別途の日付選択ウィンドウが表示されます。日付選択ウィンドウで直接日付を指定できます。

2つ目は、ショートカットボタンを使用する方法です。各日付ボタンの下には、現在、1時間、1日などのそれぞれのボタンがあります。任意のボタンをクリックし、期間範囲を指定できます。ショートカットボタンをクリックすると、下にどの日付範囲のデータを取得するかの案内が表示されます。(例：**7日前**から**現在**までのデータを検索します。)

日付選択ウィンドウを利用せずに特定の日付範囲を選択することもできます。チャートで直接照会期間を選択する方法です。チャート内で表示したい時期を横にドラッグするとエリアが選択され、そのエリアに該当する期間のデータを確認できます。チャート内で際立った値を示すエリアを選択し、その期間にフォーカスしたデータを確認できます。

## ユーザーグループ
**Compute > System Monitoring > ユーザーグループ**では、System Monitoringでモニタリングする対象に特定のイベントが発生した時、通知を受信する対象を指定できます。プロジェクトをメンバーの中から、通知を受信するメンバーを選択でき、通知を受信するユーザーを複数のグループにまとめて管理できます。

ユーザーグループがない場合、初めてユーザーグループを照会する時、空の画面が表示されます。System Monitoringで通知を受信するには、画面の案内通りにユーザーグループを追加する必要があります。

### ユーザーグループの作成
ユーザーグループを作成するには、**Compute > System Monitoring > ユーザーグループ**で、**グループ作成ボタン**をクリックします。

**グループ作成**ウィンドウで名前を入力した後、**作成**ボタンをクリックすると、ユーザーグループが作成されます。そして自動的に次の段階に移り、プロジェクトメンバーをユーザーグループに追加できます。

**ユーザーグループ編集**ウィンドウの下には、現在のプロジェクトに属するユーザーリストが表示されます。ユーザーリストの各項目右側にある**追加**ボタンをクリックして、該当ユーザーグループに追加できます。今後連携する通知グループから、ユーザーグループに属するユーザーに通知を送るように設定できます。

ユーザーグループを作成した後、**Compute > System Monitoring > ユーザーグループ**で、ユーザーグループリストを照会できます。

### ユーザーグループの修正
作成済のユーザーグループを修正するには、ユーザーリストグループで**編集**ボタンをクリックします。**編集**ボタンをクリックすると、**ユーザーグループ編集**ウィンドウが表示されます。作成段階と同じ方法で、ユーザーグループのメンバーを修正できます。

ユーザーグループ名を修正するには、ユーザーグループ名の右にある鉛筆アイコンをクリックしてください。

## 通知グループ
通知グループは、**Compute > System Monitoring > 通知グループ**で管理できます。通知グループの2つの役割は次のとおりです。
- 各システム指標にしきい値を設定できます。System Monitoringでは、システム指標にしきい値を設定したことを**監視設定**といいます。選択したシステム指標がしきい値に達すると、指定したユーザーグループに通知されます。
- 作成した監視設定をモニタリング対象サーバーと連携して、通知対象となるユーザーグループを連携できます。実質的に通知グループは、サーバーダッシュボードとユーザーグループを接続する役割だということができます。

通知グループがない場合、初めて通知グループを照会した時、空の画面が表示されます。システム指標にしきい値を設定し、任意のユーザーグループに通知を送るには、画面の案内通りに通知グループを追加する必要があります。

### 通知グループの作成
**グループ作成**ボタンをクリックして、新規通知グループを作成できます。

**グループ作成**ウィンドウでグループ名を入力し、**作成**ボタンをクリックすると、通知グループが追加されます。

### 監視設定の登録/修正/削除
監視設定を登録するには、通知グループ項目のボタンのうち、左側の**監視設定追加**ボタンをクリックします。監視設定が登録されなかった場合は、内容が何も表示されません。新規監視設定を追加するには、**監視設定追加**ボタンをクリックします。新しい監視設定入力欄が追加され、監視設定の保存はされません。任意のシステム指標にしきい値を指定し、**保存**ボタンをクリックすると、最終的に監視設定が保存されます。**キャンセル**ボタンをクリックすると入力欄は削除されます。

保存された監視設定は、右側の鉛筆アイコンをクリックして再度修正でき、ゴミ箱アイコンをクリックすると削除できます。

現在、監視設定可能なシステム指標の項目は次のとおりです。

| 項目 | 単位 | 比較方式 | 追加要求値 |
| --- | --- | --- | --- |
| リブート | リブート | - | - |
| CPU: Used | % | 以上/以下 | - |
| CPU: Idle | % | 以上/以下 | - |
| CPU: User | % | 以上/以下 | - |
| CPU: System | % | 以上/以下 | - |
| CPU: nice | % | 以上/以下 | - |
| CPU: irq | % | 以上/以下 | - |
| CPU: softirq | % | 以上/以下 | - |
| CPU: io wait | % | 以上/以下 | - |
| Load Average: 1 Min | - | 以上/以下 | - |
| Load Average: 5 Min | - | 以上/以下 | - |
| Load Average: 15 Min | - | 以上/以下 | - |
| Memory: Used | % | 以上/以下 | - |
| Memory: Used | MB | 以上/以下 | - |
| Memory: Free | MB | 以上/以下 | - |
| Memory: Buffers | MB | 以上/以下 | - |
| Memory: Cached | MB | 以上/以下 | - |
| Memory: pgpgin | KB/s | 以上/以下 | - |
| Memory: pgpgout | KB/s | 以上/以下 | - |
| Swap: Used | % | 以上/以下 | - |
| Swap: Total | MB | 以上/以下 | - |
| Swap: Used | MB | 以上/以下 | - |
| Disk: Read | Counts | 以上/以下 | - |
| Disk: Write | Counts | 以上/以下 | - |
| Disk: Read | Bytes | 以上/以下 | - |
| Disk: Write | Bytes | 以上/以下 | - |
| File System: Used | MB | 以上/以下 | `パーティション名` |
| File System: Avail | MB | 以上/以下 | `パーティション名` |
| File System: Used | % | 以上/以下 | `パーティション名` |
| File System: i-node Used | % | 以上/以下 | `パーティション名` |
| File System: Mount | - | 含む/含まない | - | `パーティション名` |
| Network: Recv | Bytes/s | 以上/以下 | `インターフェイス名` |
| Network: Send | Bytes/s | 以上/以下 | `インターフェイス名` |
| Network: Recv Packets | pps| 以上/以下 | `インターフェイス名` |
| Network: Send Packets | pps | 以上/以下 | `インターフェイス名` |
| Network: Recv Error | Counts | 以上/以下 | `インターフェイス名` |
| Network: Send Error | Counts | 以上/以下 | `インターフェイス名` |
| Network: Collision | Counts | 以上/以下 | `インターフェイス名` |
| User: User Count | - | 以上/以下 | `インターフェイス名` |
| Process: Total Count | - | 以上/以下 | - |
| Process: Down | - | - | - | `プロセス名` |
| Process: Count | - | 以上/以下 | `プロセス名` |
| Process: CPU | % | 以上/以下 | `プロセス名` |
| Process: Memory | % | 以上/以下 | `プロセス名` |
| Process: Memory | KB | 以上/以下 | `プロセス名` |
| Process: Thread Count| - | 以上/以下 | `プロセス名` |
| Process: Restart | - | - | `プロセス名` |
| File: Content | TEXT | 含む/含まない | `File Path` |
| File: Size | KB | 以上/以下 | `File Path` |
| File: Modification | - | - | `File Path` |
| File: Non-Modification | - | - | `File Path` |
| File: Non-Exist| - | - | `File Path` |

各監視項目は、固有の値単位を持っており、項目に応じてしきい値の他に追加で値を要求することもできます。

#### 監視設定持続時間
監視設定の持続時間は重要な要素です。持続時間は、監視対象が指定したしきい値に達した後、その状態が持続する時間を条件に指定する時に使用します。例えば、CPU使用率のしきい値が90%以上で、持続時間が5分の場合、該当通知グループと連携されたサーバーのCPU使用率が90%以上の状態が5分以上持続した時、ユーザーグループに定義されたユーザーに通知します。もしCPU使用率が90%以上でも、5分以内に90%未満に落ちた場合は通知をしません。


### 監視対象および通知対象設定
定義した監視設定を適用するモニタリング対象サーバーと監視条件が満たされると、通知を受信するユーザーグループを接続できます。**監視設定**ボタン右側の**サーバーおよびユーザーグループ連携** ボタンをクリックします。

上では該当通知グループに定義された監視設定を反映するサーバーを指定します。下では監視条件を満たした時に、通知を受信するユーザーグループを指定します。選択を解除するには、サーバーまたはユーザーグループ名の右にある**X**ボタンをクリックするか、ドロップダウンメニューから再選択して選択を解除できます。

その後、**Compute > System Monitoring > 通知グループ**で設定した通知グループリストを照会できます。

## 月間指標レポート
月間指標レポートは **Compute > System Monitoring > 月間指標レポート**で利用できます。

### GENERALレポートタイプ
* **サーバーダッシュボード**を基準に月間指標レポートを作成します。
* **CPU平均**、**CPU最大**、**メモリ平均**、**メモリ最大**、**ネットワーク送信**、**ネットワーク受信**、**ファイルシステム使用率**のうち1つ以上の指標を選択できます。
* 周期は **5分**、**30分**、**2時間**、**1日**のいずれかを選択でき、選択した周期によって選択できる**月**の値が変わります(最大6か月前まで選択可能)。
* **ダウンロードリクエスト**をクリックしてレポートの作成をリクエストします。作成されたリストは**レポート作成リクエスト状況**で確認できます。
  * レポートの作成は非同期で行われるため、作成が完了するまではダウンロードできません。

### PROMQLレポートタイプ
* **OpenMetricsダッシュボード**を基準に月間指標レポートを作成します。
* 指標はPROMQLクエリを使用します。これは**OpenMetricsダッシュボード**のチャートで使用するものと同じで、詳細な例は[https://prometheus.io/docs/prometheus/latest/querying/basics/](https://prometheus.io/docs/prometheus/latest/querying/basics/)で確認できます。
* 周期は **5分**、**30分**、**2時間**、**1日**のいずれかを選択でき、選択した周期によって選択できる**月**の値が変わります(最大6か月前まで選択可能)。
* **ダウンロードリクエスト**をクリックしてレポートの作成をリクエストします。作成されたリストは**レポート作成リクエスト状況**で確認できます。
   * レポートの作成は非同期で行われるため、作成が完了するまではダウンロードできません。


## Agentのインストール方法

### Linux
1. root権限必要
2. インスタンス内インストールスクリプトの存在を確認
    * 下記のパスにスクリプトファイルがあるかどうかを確認してください。
`/opt/toast-sysmon-install.sh`

3. インストールスクリプトのダウンロード
    * 2番で確認したファイルがない場合は、下記のリンクからダウンロードしてください。
https://static.toastoven.net/toastcloud/sdk_download/monitoring/toast-sysmon-install.sh

4. サーバーでインストールスクリプトを実行
    * サーバーでインストールスクリプトを実行します。インストールが完了したら、自動的にモニタリングが始まります。


### Windows
1. Administrator権限必要
2. インスタンス内インストールスクリプトの存在を確認
    * 下記パスにスクリプトファイルがあるかどうかを確認してください。
`C:\Program Files(x86)\NHN\toast-sysmon-install.ps1`

3. インストールスクリプトのダウンロード
    * 2番で確認したファイルがない場合は、下記のリンクからダウンロードしてください。
https://static.toastoven.net/toastcloud/sdk_download/monitoring/toast-sysmon-install.ps1

4. サーバーでインストールスクリプトを実行
    * サーバーでインストールスクリプトを実行します。インストールが完了したら、自動的にモニタリングが始まります。
