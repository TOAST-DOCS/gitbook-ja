## Governance & Audit > Resource Watcher > コンソール使用ガイド

### はじめる

Resource Watcherは、組織を有効にするとデフォルトで提供されるサービスです。
そのため組織を作成した後、別途作業不要で**サービス選択**から**Resource Watcher**を選択して使用できます。

リソースで発生するさまざまな変更事項についての通知を受け取るには
まずリソースグループまたはリソースタグを定義した後、通知を作成する順序で設定する必要があります。
通知を設定した後に作成または変更されたリソースについての通知を受け取ることができます。


### リソースタグ

リソースタグを自由に設定してリソースを区別して管理できます。

リソースタグの名前を変更すると、リソースに設定されていたタグも含めて一緒に変更できます。タグ名を修正した後、リソースに設定したタグを変更する作業を自動的に処理して利便性と一貫性を提供します。
リソースには1つ以上のリソースタグを設定でき、リソースタグは1つ以上のリソースに設定できます。
リソースタグは、リソースグループと通知で対象リソースの選択に活用できます。

リソースタグは、ユーザーが直接作成してリソースに設定でき、またシステムにより自動的にリソースに設定されることがあります。

| リソースタグ区分 | 説明 |
|---|---|
| ユーザータイプ | <li>ユーザーが作成したリソースタグです。</li><li>リソースタグの名前を変更できます。</li><li>リソースに自由にリソースタグを設定または解除できます。</li>  |
| システムタイプ | <li>システムで作成したリソースタグです。</li><li>リソースが作成されるとシステムにより自動的にリソースタグが設定されます。</li><li>ユーザーはリソースにシステムタイプのリソースタグを設定または解除できません。</li> |

> システムタイプのリソースタグは現在プロジェクト名のタグをサポートする予定で、各リソースのプロジェクト情報をタグで管理できます。システムタイプリソースタグは、今後も継続的に追加する計画です。

#### リソースタグ検索

リソースタグ検索画面は次のように構成されています。

![resourcewatcher_11](https://static.toastoven.net/prod_resource_watcher/img11_JP.png)

| 項目 | 説明 |
|---|---|
| リソースタグ検索条件 | 次のような検索条件を指定して該当するリソースタグリストを検索できます。<li>リソースタグ区分：USER (ユーザータイプ)、SYSTEM (システムタイプ)</li><li>リソースタグキー：入力した名前を含むリソースタグの選択</li><li>最終修正日時：最後に修正された期間のリソースタグ選択 |
| リソースタグの作成および削除 | 新しいリソースタグを追加するか、リストに表示されたリソースタグを選択して削除できます。 |
| リソースタグ全体選択 | 画面に表示されたすべてのリソースタグを選択するか、選択を解除します。 |
| リソースタグ項目表示 | リソースタグの名前、区分、最終修正日時情報を画面に表示します。各リソースタグを選択して削除できます。 |
| リソースタグ別リソースリスト照会 | リソースタグが設定されているリソースリストを照会できます。 |
| 修正 | リソースタグの名前を変更できます。 |

**リソースタグ別リソースリスト照会**を押すと、画面下部に次のようにリソースリストが表示されます。

![resourcewatcher_12](https://static.toastoven.net/prod_resource_watcher/img12_JP.png)

| 項目 | 説明 |
|---|---|
| タグ名 | 選択したタグの名前を表示します。 |
| リソース検索条件 | 次のような検索条件でリソースタグに含まれるリソースのリストを検索できます。<li>プロジェクト名：リソースが作成されたプロジェクトのリストを表示します。</li><li>サービス：該当組織で使用中のサービスリストを表示します。</li><li>リソースタイプ：使用中のNHN Cloudサービスで提供するリソースタイプリストを表示します。</li><li>リージョン：該当組織で使用できるリージョンリストを表示します。</li><li>リソース名：入力した検索ワードを含むリソースを選択します。</li><li>リソース作成日時：リソースが作成された期間を指定します。 |
| リソースリスト | 選択したリソースタグリソースリストを表示します。 |

> リソースタグ検索画面では、リソースタグを設定したリソースリストの照会のみ提供します。
> リソースにタグを設定する機能は**リソース**メニューで提供します。

#### リソースタグの作成

リソースタグを作成するにはリソースタグ検索画面で**+ リソースタグ作成**を押します。

![resourcewatcher_13](https://static.toastoven.net/prod_resource_watcher/img13_JP.png)

リソースタグ作成画面で追加するタグ名を入力し、**確認**を押すとリソースタグが作成されます。
同じリソースタグがすでに存在する場合は作成されません。

#### リソースタグの修正

リソースタグ検索画面のリソースタグリストで変更する項目に対して**修正**を押します。
タグ名を修正した後、**確認**を押して変更事項を反映します。

> リソースタグを修正すると、当該タグが設定されたリソースのタグ設定値が一緒に変更されます。

#### リソースタグの削除

リソースタグ検索画面のリソースタグリストから削除する項目のチェックボックスを選択して削除できます。
複数の項目を一度に削除することもできます。

リソースタグを削除する時の注意事項は次のとおりです。
- リソースタグを削除すると、当該タグが設定されたすべてのリソースからタグ設定値が一緒に削除されます。
- リソースグループ作成時、**リソース選択**をリソースタグに設定し、該当タグを対象項目に設定した場合、リソースグループからもタグ項目が削除されます。
- 通知作成時、**対象リソース**を**リソースタグ選択**に設定し、当該タグが設定されている場合、通知対象からもタグ項目が削除されます。

![resourcewatcher_14](https://static.toastoven.net/prod_resource_watcher/img14_JP.png)



### リソースグループ

リソースグループをさまざまな方式で作成してリソースを区分して管理できます。
以下の表のリソースグループ作成方式の中から1つを指定してリソースグループを作成できます。

| リソースグループ作成方式 | 説明 |
|---|---|
| リソースタイプ | <li>指定したリソースのタイプと一致するリソースをリソースグループに含めます。</li><li>リソースが作成されると、リソースタイプと一致するリソースグループにリソースが自動的に追加されます。</li>  |
| リソースタグ | <li>指定したリソースタグを持つリソースをリソースグループに含めます。</li><li>リソースにリソースタグを追加すると、同じタグをもとに作成されたリソースグループにリソースが自動的に追加されます。</li>  |
| リソース直接選択 | <li>リソースグループに含める対象リソースを画面で選択して指定します。</li> |

> リソースは1つ以上のリソースグループに含めて管理できます。
> リソースが削除されるとリソースグループからリソースが自動的に除去されます。

#### リソースグループの検索

リソースグループ検索画面は次のように構成されています。

![resourcewatcher_01](https://static.toastoven.net/prod_resource_watcher/img01_JP.png)

| 項目 | 説明 |
|---|---|
| リソースグループ検索条件 | 次のような検索条件を指定して該当するリソースグループを検索できます。<li>リソースグループ作成タイプ</li><li>リソースグループ名/リソースグループ説明：入力した検索ワードを含むリソースグループを選択</li><li>最終修正日時：最後に修正された期間のリソースグループ選択 |
| リソースグループの作成および削除 | 新しいリソースグループを追加、またはリストに表示されたリソースグループを選択して削除できます。 |
| リソースグループ全体選択 | 画面に表示されたすべてのリソースグループを選択または解除します。 |
| リソースグループ項目表示 | リソースグループの名前、説明、作成タイプ、最終修正日時情報を画面に表示します。それぞれのリソースグループを選択して削除できます。 |
| リソースグループ別リソースリスト照会 | リソースグループに含まれているリソースリストを照会できます。 |
| 修正 | リソースグループの設定を変更できます。 |

**リソースグループ別リソースリスト照会**を押すと、画面下部に次のようにリソースリストが表示されます。

![resourcewatcher_02](https://static.toastoven.net/prod_resource_watcher/img02_JP.png)

| 項目 | 説明 |
|---|---|
| リソース検索条件 | 次のような検索条件でリソースグループに含まれるリソースのリストを検索できます。<li>プロジェクト名：リソースが作成されたプロジェクトのリストを表示します。</li><li>サービス：該当組織で使用中のサービスリストを表示します。</li><li>リソースタイプ：使用中のNHN Cloudサービスで提供するリソースタイプリストを表示します。</li><li>リージョン：該当組織で使用できるリージョンリストを表示します。</li><li>リソース名：入力した検索ワードを含むリソースを選択します。</li><li>リソース作成日時：リソースが作成された期間を指定します。 |
| リソースリスト | 選択したリソースグループに含まれるリソースリストを表示します。 |


#### リソースグループの作成

リソースグループを作成するにはリソースグループ検索画面で**リソースグループ作成**をクリックします。

![resourcewatcher_03](https://static.toastoven.net/prod_resource_watcher/img03_JP.png)

| 項目 | 説明 |
|---|---|
| 作成 | リソースグループの基本情報および作成方式を指定します。 |
| リソースプレビュー | **作成**タブで設定した作成方式によりリソースグループに含まれるリソースのリストを照会します。 |
| リソース選択 | リソースグループがリソースを含める方式を指定します。 **リソースタイプ**、**リソースタグ**、**リソース直接選択**のいずれかを指定して対象項目を選択できます。 |
| 選択された項目表示 | 選択可能な項目からユーザーが指定した項目を表示します。名前の右側にある[X]ボタンを押すと選択された項目から外すことができます。 |
| 選択可能な項目表示 | リソース選択方式に基づいて設定可能な項目をリストで表示します。**リソースタイプ**と**リソースタグ**は検索ワードでフィルタリングできます。 |

**作成**タブで**リソース選択**方式を指定すると**リソースプレビュー**タブで選択したリソースリストを確認できます。

![resourcewatcher_04](https://static.toastoven.net/prod_resource_watcher/img04_JP.png)

| 項目 | 説明 |
|---|---|
| リソースリスト | リソースグループ作成方式により選択したリソースリストを表示します。 |
| リソース検索条件 | リソースリストをフィルタリングできます。 |


#### リソースグループの修正

リソースグループの名前、説明およびリソース作成タイプを変更できます。
リソースグループの作成と同じ方法で修正できます。

#### リソースグループの削除

リソースグループ検索画面のリソースグループリストから削除する項目のチェックボックスを選択して削除できます。
複数の項目を一度に削除することもできます。

![resourcewatcher_05](https://static.toastoven.net/prod_resource_watcher/img05_JP.png)


### 通知

関心のある対象リソースの変更事項を検出して条件に基づいてEmail、SMS、Webhookなどの通知を送信し、送信された通知の履歴を管理できます。

通知の対象リソースはリソースグループまたはリソースタグを利用して設定できます。
したがって通知を作成する前にリソースグループまたはリソースタグを作成する必要があります。通知対象を選択する時にすでに他の通知に使用していたリソースグループまたはリソースタグを再度指定して
通知を作成した後にリソースが追加されても該当リソースが通知作成時に設定したリソースグループまたはリソースタグに含まれている場合、自動的に通知の対象に含まれます。

알림을 생성할 때 이벤트를 선택하고 대상 리소스를 지정하면 해당 리소스에서 해당하는 이벤트가 발생했을 때 사용자에게 알림을 전송합니다.
이때 선택하는 이벤트는 CloudTrail 서비스에서 제공하는 이벤트 목록과 동일합니다.

#### 通知検索

通知検索画面は次のように構成されています。

![resourcewatcher_31](https://static.toastoven.net/prod_resource_watcher/img31_JP.png)

| 項目 | 説明 |
|---|---|
| 通知検索条件 | 次のような検索条件を指定して該当するリソースを検索できます。<li>通知状態：有効化、無効化状態の通知を指定します。</li><li>通知名/通知説明検索：入力した検索ワードを含む通知を検索します。</li><li>通知最終修正日時：最後に修正された期間の通知を検索します。</li> |
| 通知作成、通知削除 | 通知を作成、または選択した通知を削除します。 |
| 通知全体選択 | 画面に表示されたすべての通知を選択、または解除します。 |
| 通知項目表示 | 検索された通知の情報を画面に表示します。 |
| 通知状態変更 | 該当通知の状態をトグルスイッチで変更できます。<li>青色は通知が有効になった状態で、通知条件を満たすイベントが発生した時に通知を送信します。</li><li>灰色は通知が無効になった状態で、イベントが発生しても通知を送信しません。</li> |
| 通知詳細表示 | **表示**を押して該当通知の通知履歴と対象リソース情報を確認できます。 |
| 通知修正 | 通知の名前と説明、対象リソースと通知受信対象を修正できます。 |

**表示**を押すと画面下部に次のように通知履歴と通知対象リソースリストを表示します。

![resourcewatcher_32](https://static.toastoven.net/prod_resource_watcher/img32_JP.png)

| 項目 | 説明 |
|---|---|
| 通知名 | 選択した通知の名前を表示します。 |
| 通知履歴照会、リソースリスト照会 | 通知履歴と対象リソース情報を確認できます。 |
| 通知履歴検索条件 | 通知履歴リストをフィルタリングできます。 |
| 通知履歴リスト | 検索された通知履歴の情報を画面に表示します。通知発生日時と通知が発生したリソース名、プロジェクト、通知送信結果を確認できます。 |

> 通知履歴の送信結果は次のとおりです。   
> - 成功：通知作成時に設定した通知受信対象への通知送信リクエストが成功しました。
> - 失敗：通知受信対象の一部または全ての通知送信リクエストが失敗しました。

**リソースリスト照会**タブを押すと、画面下部に通知対象リソースリストが表示されます。

![resourcewatcher_33](https://static.toastoven.net/prod_resource_watcher/img33_JP.png)

| 項目 | 説明 |
|---|---|
| リソース検索条件 | 通知対象リソースリストをフィルタリングできます。 |
| リソースリスト | 検索された通知対象リソースリストを画面に表示します。  |

#### 通知作成

通知を作成するには通知検索画面で**通知作成**を押します。

![resourcewatcher_35](https://static.toastoven.net/prod_resource_watcher/img35_JP.png)

| 項目     | 説明 |
|--------|---|
| 通知作成   | **通知作成**を押すと、通知情報を入力できます。 |
| 이벤트 선택 | 通知を受け取りたい通知ルールを指定します。 |
| 対象リソース | 通知を受け取りたい対象リソースを指定します。<li>**リソースグループ**と**リソースタグ**を指定できます。**追加**を押すと選択されます。</li><li>複数の項目を選択すると各項目に設定されたすべてのリソースが対象になります。</li><li>選択した対象を除去するには右側の[X]ボタンを押します。</li> |
| 通知受信対象 | 通知送信時にEmail、SMSを送る受信対象を設定します。通知受信対象タイプは次のとおりです。<li>組織メンバー：NHN Cloud会員、IAM会員を直接選択できます。</li><li>通知受信グループ：組織の通知受信グループリストで事前に定義された受信対象を選択できます。複数の通知で同じ通知受信者設定が必要な場合は**コンソール** > **組織** > **通知受信グループ管理**で登録して使用することを推奨します。</li><li>役割：選択した役割を持つすべてのメンバーに通知を送信します。組織役割、プロジェクト役割、プロジェクト共通役割グループ、サービス役割で選択できます。</li> |
| Webフック | 通知を送信する時にWebHookリクエストを転送できます。<li>httpsプロトコルをサポートします。</li><li>WebHook Payload Specは[コンソール使用ガイド]を参照してください。</li><li>秘密鍵を入力するとHMAC認証情報をヘッダに追加して転送します。 [コンソール使用ガイド]を参照してください。</li> |
| 確認     | 通知作成に必要な通知ルール、対象リソース、通知受信対象またはWebフックをすべて設定し、**確認**を押すと通知が作成されます。 |

> 通知受信対象で`役割`タイプを選択した場合、選択した役割が設定されたメンバーにのみ通知が送信されます。  
> 例えば`ADMIN`役割を選択した場合、 `OWNER`役割を持つメンバーには通知が送信されません。
> 
> プロジェクト役割を選択した場合、イベントが発生したリソースが属するプロジェクトのメンバーのうち、選択した役割が設定されたメンバーにのみ通知が送信されます。  
> 例えば、2つのプロジェクトが作成されていてADMINメンバーを選択した場合、プロジェクトAで作成されたリソースで通知が発生するとプロジェクトAのADMIN役割を持つプロジェクトメンバーに通知が送信されます。

#### 通知の修正

通知の名前、説明, 이벤트および対象リソース、通知受信対象またはWebフック設定を変更できます。
- リストですでに作成された通知設定を修正し、**追加**をクリックすると、修正した値に反映します。
  - 例：Emailのみ選択して値が保存されている場合、リストからSMSを選択して**追加**を押すとその値にアップデートします。

#### 通知の削除

通知検索画面の通知リストから削除する項目のチェックボックスを選択して削除できます。複数の項目を一度に削除することもできます。

![resourcewatcher_34](https://static.toastoven.net/prod_resource_watcher/img34_JP.png)

> 通知を削除すると、通知を受信しなくなります。
> その通知で発生した通知履歴情報が一緒に削除され、復元できなくなります。
> 通知の削除はリソースおよびリソースグループ、リソースタグに影響を与えません。

### リソース

NHN Cloud組織内のさまざまなサービスが管理しているリソースを管理できます。
同じサービスを複数のプロジェクトで使用する場合は、各プロジェクトのサービスコンソールにアクセスしなくてもResource Watcherサービスを利用して、人目でリソースリストを確認し、各リソースのイベントを照会できます。
またリソースにリソースタグを設定し、リソースグループを設定してさまざまな観点で分類できます。

リソースは、次のような体系の一部として管理します。

| 項目 | 説明 |
|---|---|
| サービス | <li>ユーザーが利用中のNHN Cloudのサービスを意味します。</li><li>例えば基本インフラサービス、 Kubernetes、Deployなどです。 | 
| リソースタイプ | <li>リソースタイプは物理的に作成されたリソースを分類する単純で基本的な情報です。</li><li>各サービスはさまざまなリソースタイプで構成されることがあります。</li><li>例えば基本インフラサービスはCompute Instance、Networkなどのサービスで構成されており、Instance、VPCなどのリソースタイプをユーザーに提供します。</li><li>リソースタイプはリソースの生まれつき属性情報と呼ばれ、リソースタグと一緒に提供する分類基準の一部です。 | 
| リソース | <li>各サービスで作成され管理される実体化された対象です。</li><li>例えばCompute > Instanceサービスで管理するインスタンスや、Network > VPCサービスで管理するVPCになります。</li><li>それぞれのリソースは名前や実装タイプなど、自分の設定情報を持っています。</li><li>またリソースと関連がある場合もあります。 |
| イベント | <li>リソースごとに発生する可能性のあるさまざまなイベントが存在します。</li><li>CloudTrailでは、複数のリソースで作成されるさまざまなイベントを一度に照会し、管理できます。</li><li>Resource Watcherでは個別リソースごとに発生したさまざまなイベントを細かく照会できます。 |

リソースは以下のような情報で構成されます。

| 項目 | 説明 |
|---|---|
| リソース名 | ユーザーが定義したか、システムにより自動的に付与された名前。 |
| リソースID | リソースが作成される時に付与された識別情報。<br>サービスごとに固有の範囲が異なる場合があり、固有識別情報として使用するのは難しいです。 |
| NCRN | NCRN(NHN Cloud Resource Name)はNHN Cloudサービス全体でリソースを識別できる唯一の識別キー情報。<br>表示形式：`組織ID`：`プロジェクトID`：`リソースタイプ`：`アプリケーションキー`：`リージョンコード：`リソースID`<br>例： `IU1gUaQki7fDv97V:5FlHkACb:INSTANCE:9hR8Mh5nG4inePQh:KR1:f75ad8ad-a97e-47b6-acec-8c09304290c5` |
| プロジェクト | リソースが作成されたプロジェクト名。<br>組織商品リソースの場合、当該情報を表示しない。 |
| サービス | リソースが属するサービス情報。 |
| リソースタイプ | リソースが属するリソースタイプ情報。 | 
| リージョン | 当該リソースが作成されたリージョン情報。<br>リージョンを区別しないサービスのリソースは表示しない。 |
| リソースグループリスト | リソースを含むリソースグループのリスト |
| リソースタグリスト | リソースに設定されているリソースタグリスト | 


#### リソース検索

リソース検索画面は次のように構成されています。

![resourcewatcher_41](https://static.toastoven.net/prod_resource_watcher/img41_JP.png)

| 項目 | 説明 |
|---|---|
| リソース検索条件 | 次のような検索条件を指定して該当するリソースを検索できます。<li>プロジェクト名</li><li>サービス</li><li>リソースタイプ</li><li>リージョン</li><li>リソースグループ</li><li>リソースタグ</li><li>リソース名</li><li>リソース作成日時 |
| リソースタグ設定 | 選択したリソースにリソースタグを設定します。 |
| リソース全体選択 | 画面に表示されているすべてのリソースを選択または解除します。 |
| リソース項目表示 | 検索されたリソースの情報を画面に表示します。**表示**を押すと詳細なリソース情報を確認できます。 |
| リソースグループ | 該当リソースを含むリソースグループのうち1件を表示し、設定されているリソースグループの数を表示します。リソースグループリスト全体を確認するにはその位置をクリックします。  |
| リソースタグ | 当該リソースに設定されているリソースタグのうち1件を表示し、設定されているリソースタグの数を表示します。リソースタグリスト全体を確認するにはその位置をクリックします。 |
| ホバリングメニュー | リソースグループまたはリソースタグのリスト全体を表示します。 |
| 詳細表示 | 該当リソースの`基本情報`と`イベント`を照会します。 |

> NHN Cloudサービスで各リソースを作成または削除すると、Resource Watcherサービスでリソース情報が自動的に同期されて表示されます。
> リソースを作成するとリストに表示され、リソースを削除するとリストから削除され表示されません。今後、削除されたリソースも照会できる機能を提供する予定です。

**表示**を押すと画面下部に次のようにリソースの基本情報とイベントリストが表示されます。

![resourcewatcher_42](https://static.toastoven.net/prod_resource_watcher/img42_JP.png)

| 項目 | 説明 |
|---|---|
| 基本情報、イベント照会 | リソースの基本情報を照会できるタブとリソースで発生したイベントを照会するタブを提供します。 |
| リソース基本情報項目 | 選択したリソースの基本情報を表示します。 |

**イベント照会**タブを押すと、画面下部にリソースで発生したイベントリストを表示します。

![resourcewatcher_43](https://static.toastoven.net/prod_resource_watcher/img43_JP.png)

| 項目 | 説明 |
|---|---|
| イベント検索条件 | 次のような検索条件で、リソースで発生したイベントリストを検索できます。<li>イベント：当該リソースタイプで発生可能なイベントのリストを指定します。</li><li>イベント発生日時：イベントが発生した期間を指定します。 |
| イベントリスト | 該当リソースで発生したイベントリストを表示します。 |


#### リソースタグ設定

リソースにリソースタグを設定するにはリソース検索画面で**リソースタグ設定**をクリックします。

![resourcewatcher_45](https://static.toastoven.net/prod_resource_watcher/img45_JP.png)

| 項目 | 説明 |
|---|---|
| リソース選択 | リソースタグを設定するリソースのチェックボックスを選択します。チェックボックスを選択すると**リソースタグ設定**ボタンが有効になります。 |
| リソースタグ設定 | **リソースタグ設定**を押すと設定画面がポップアップ表示されます。 |
| リソースタグ選択 | 設定する対象リソースタグのリストを検索します。リソースタグの名前が部分一致するタグリストを照会します。 |
| 選択可能な項目を表示 | すべてのリソースタグリストを表示し、当該リソースに設定されているリソースタグが存在する場合は各タグ項目にチェックボックスを有効にして表示します。 |
| 確認 | **リソースタグ設定**画面の内容を反映します。 |

リソースタグ設定時の注意事項
> リソースタグを設定すると、既に設定されているリソースタグリストがすべて初期化され、新しく指定したリソースタグに設定されます。
